{% extends "hotellapp/base.html" %}
{% block content %}
<section class="d-flex justify-content-between align-items-center">
  <div>
    <h2 class="mb-0">Invoice {{ invoice.series }}-{{ invoice.number|default:invoice.id }}</h2>
    <div class="text-muted small">Issued on: <span class="badge text-bg-light">{{ invoice.issue_date }}</span></div>
  </div>
  <div class="d-flex gap-2">
    <a href="{% url 'invoice_edit' invoice.pk %}" class="btn btn-outline-primary"><i class="bi bi-pencil-square"></i> Edit</a>
    <a href="{% url 'invoice_print' invoice.pk %}" class="btn btn-primary"><i class="bi bi-printer"></i> Print</a>
  </div>
</section>

<div class="card mt-3">
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <h5>Client</h5>
        <p class="mb-1">{{ invoice.client.first_name }} {{ invoice.client.last_name }}</p>
        <p class="mb-1">{{ invoice.client.email }}</p>
        <p class="mb-0">{{ invoice.client.phone }}</p>
      </div>
      <div class="col-md-6 text-md-end">
        <h5>Invoice</h5>
        <p class="mb-1"><strong>Due date:</strong> {{ invoice.due_date }}</p>
        <p class="mb-1"><strong>Payment:</strong> {{ invoice.get_payment_method_display }}</p>
        <p class="mb-0"><strong>Currency:</strong> {{ invoice.currency }}</p>
      </div>
    </div>

    <hr />
    <div class="table-responsive">
      <table class="table table-striped align-middle table-modern">
        <thead>
          <tr>
            <th>Description</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Unit price</th>
            <th class="text-end">VAT %</th>
            <th class="text-end">Net</th>
            <th class="text-end">VAT</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for line in invoice.lines.all %}
          <tr>
            <td>{{ line.description }}</td>
            <td class="text-end">{{ line.quantity }}</td>
            <td class="text-end">{{ line.unit_price }}</td>
            <td class="text-end">{{ line.vat_rate }}</td>
            <td class="text-end">{{ line.total_excl_vat }}</td>
            <td class="text-end">{{ line.vat_amount }}</td>
            <td class="text-end">{{ line.total }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="text-center text-muted">No items.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot>
          {% for row in invoice.get_vat_summary %}
          <tr>
            <th colspan="4" class="text-end">Subtotal (VAT {{ row.vat_rate }}%)</th>
            <th class="text-end">{{ row.base }}</th>
            <th class="text-end">{{ row.vat }}</th>
            <th class="text-end">{{ row.total }}</th>
          </tr>
          {% endfor %}
          <tr class="table-light">
            <th colspan="6" class="text-end">Grand Total</th>
            <th class="text-end">{{ invoice.total }} {{ invoice.currency }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="mt-3">
      <h5>Reservation</h5>
      <p class="mb-1"><strong>Room:</strong> {{ invoice.reservation.room.number }} ({{ invoice.reservation.room.get_type_display }})</p>
      <p class="mb-1"><strong>Check-in:</strong> {{ invoice.reservation.check_in }}</p>
      <p class="mb-1"><strong>Check-out:</strong> {{ invoice.reservation.check_out }}</p>
      <p class="mb-1"><strong>Nights:</strong> {{ invoice.reservation.nights }}</p>
      <p class="mb-0"><strong>Breakfast:</strong>
        {% if invoice.reservation.breakfast_included %}Included ({{ invoice.reservation.breakfast_price }} per night){% else %}No{% endif %}
      </p>
    </div>
  </div>
</div>

<p class="text-muted mt-3">Tip: Pentru PDF, vezi metoda Invoice.render_pdf din cod (WeasyPrint/ReportLab).</p>
{% endblock %}
