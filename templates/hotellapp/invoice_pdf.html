{% extends "hotellapp/base.html" %}
{% block content %}
<style>
@media print {
  .no-print { display: none !important; }
}
.invoice {
  max-width: 900px;
  margin: 0 auto;
  border: 1px solid #dee2e6;
  border-radius: .5rem;
  font-size: 0.95rem;
}
.invoice .header {
  background: #f8f9fa;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #dee2e6;
}
.invoice .body {
  padding: 1.5rem;
}
</style>

<div class="no-print mb-3">
  <a href="{% url 'invoice_detail' invoice.pk %}" class="btn btn-outline-secondary">Back</a>
  <button class="btn btn-primary" onclick="window.print()">Print</button>
</div>

<div class="invoice">
  <div class="header d-flex justify-content-between align-items-center">
    <h3 class="mb-0">Invoice {{ invoice.series }}-{{ invoice.number|default:invoice.id }}</h3>
    <div class="text-end">
      <div><strong>Date:</strong> {{ invoice.issue_date }}</div>
      <div><strong>Due date:</strong> {{ invoice.due_date }}</div>
      <div><strong>Payment:</strong> {{ invoice.get_payment_method_display }}</div>
      <div><strong>Total:</strong> {{ invoice.total }} {{ invoice.currency }}</div>
    </div>
  </div>
  <div class="body">
    <div class="row">
      <div class="col-md-6">
        <h5>Billing</h5>
        <p class="mb-1">{{ invoice.billing_name|default:invoice.client.first_name|add:" "|add:invoice.client.last_name }}</p>
        {% if invoice.billing_tax_id %}<p class="mb-1"><strong>Tax ID:</strong> {{ invoice.billing_tax_id }}</p>{% endif %}
        {% if invoice.billing_address %}<p class="mb-0">{{ invoice.billing_address }}</p>{% endif %}
      </div>
      <div class="col-md-6">
        <h5>Reservation</h5>
        <p class="mb-1"><strong>Room:</strong> {{ invoice.reservation.room.number }} ({{ invoice.reservation.room.get_type_display }})</p>
        <p class="mb-1"><strong>Check-in:</strong> {{ invoice.reservation.check_in }}</p>
        <p class="mb-1"><strong>Check-out:</strong> {{ invoice.reservation.check_out }}</p>
        <p class="mb-1"><strong>Nights:</strong> {{ invoice.reservation.nights }}</p>
        <p class="mb-0"><strong>Breakfast:</strong>
          {% if invoice.reservation.breakfast_included %}Included ({{ invoice.reservation.breakfast_price }} per night){% else %}No{% endif %}
        </p>
      </div>
    </div>

    <hr />
    <div class="table-responsive">
      <table class="table table-sm table-striped align-middle">
        <thead>
          <tr>
            <th>Description</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Unit</th>
            <th class="text-end">VAT %</th>
            <th class="text-end">Net</th>
            <th class="text-end">VAT</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for line in invoice.lines.all %}
          <tr>
            <td>{{ line.description }}</td>
            <td class="text-end">{{ line.quantity }}</td>
            <td class="text-end">{{ line.unit_price }}</td>
            <td class="text-end">{{ line.vat_rate }}</td>
            <td class="text-end">{{ line.total_excl_vat }}</td>
            <td class="text-end">{{ line.vat_amount }}</td>
            <td class="text-end">{{ line.total }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="text-center text-muted">No items.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot>
          {% for row in invoice.get_vat_summary %}
          <tr>
            <th colspan="4" class="text-end">Subtotal (VAT {{ row.vat_rate }}%)</th>
            <th class="text-end">{{ row.base }}</th>
            <th class="text-end">{{ row.vat }}</th>
            <th class="text-end">{{ row.total }}</th>
          </tr>
          {% endfor %}
          <tr class="table-light">
            <th colspan="6" class="text-end">Grand Total</th>
            <th class="text-end">{{ invoice.total }} {{ invoice.currency }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
{% endblock %}
